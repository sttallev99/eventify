<div data-controller="event-form" class="flex min-h-full flex-col w-full justify-center px-6 py-12 lg:px-8">
  <div class="sm:mx-auto sm:w-full sm:max-w-sm">
    <h2 class="mt-4 text-center text-2xl/9 font-bold tracking-tight text-black">Create a new event</h2>
  </div>

  <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-sm">
    <%= form_with model: @event, local: true, html: { multipart: true, data: { action: "submit->event-form#submitForm" } } do |f| %>
      <div class="space-y-6">
        <div>
          <%= f.label :title, "Title", class: "block text-sm/6 font-medium text-black" %>
          <div class="mt-2">
            <%= f.text_field :title, class: "block border w-full rounded-md bg-white/5 px-3 py-1.5 text-base text-black placeholder:text-gray-500 sm:text-sm/6" %>
            <%= field_error(@event, :title) %>
          </div>
        </div>

        <div>
          <%= f.label :location, "Location", class: "block text-sm/6 font-medium text-black" %>
          <div class="mt-2">
            <%= f.text_field :location, class: "block border w-full rounded-md bg-white/5 px-3 py-1.5 text-base text-black placeholder:text-gray-500 sm:text-sm/6" %>
            <%= field_error(@event, :location) %>
          </div>
        </div>

        <div>
            <%= f.label :starts_at, "Event Start Date", class: "block text-sm/6 font-medium text-black" %>

            <div class="mt-2">
                <%= f.date_field :starts_at,
                  class: "block w-full rounded-md border bg-white/5 px-3 py-1.5 text-base text-black
                    placeholder:text-gray-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500
                    sm:text-sm/6" 
                %>
                <%= field_error(@event, :starts_at) %>
            </div>
        </div>

        <div>
            <%= f.label :ends_at, "Event End Date", class: "block text-sm/6 font-medium text-black" %>

            <div class="mt-2">
                <%= f.date_field :ends_at,
                  class: "block w-full rounded-md border bg-white/5 px-3 py-1.5 text-base text-black
                    placeholder:text-gray-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500
                    sm:text-sm/6"
                %>
                <%= field_error(@event, :ends_at) %>
            </div>
        </div>

        <div>
            <%= f.label :category_id, "Category", class: "block text-sm/6 font-medium text-black" %>

            <div class="mt-2">
              <%= f.collection_select :category_id,
                (@categories || Category.all),
                :id,
                :name,
                { include_blank: "Select category" },
                class: "block w-full rounded-md border bg-white/5 px-3 py-1.5 text-base text-black
                  placeholder:text-gray-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500
                  sm:text-sm/6" 
              %>
              <%= field_error(@event, :category_id) %>
            </div>
        </div>

        <div class="flex flex-col items-center">
          <%= f.label :description, "Description", class: "self-start w-[600px] text-left text-sm/6 font-medium text-black" %>

          <div class="mt-2 w-[600px]">
              <%= f.rich_textarea :description %>
              <%= field_error(@event, :description) %>
          </div>
        </div>

        <div class="mb-4">
          <%= f.label :images, "Upload Images", class: "block text-sm font-medium text-gray-700 mb-2" %>

          <div class="flex flex-col items-center justify-center w-full">
            <label
              for="images-upload"
              class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors"
            >
              <svg class="w-10 h-10 mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M7 16V4m0 0L3 8m4-4l4 4m6 8v-8m0 0l4 4m-4-4l-4 4"/>
              </svg>
              <span data-event-form-target="labelText" class="text-sm text-gray-500">
                Click to upload or drag and drop
              </span>
              <%= f.file_field :images,
                multiple: true,
                id: "images-upload",
                class: "hidden",
                data: { event_form_target: "fileInput", action: "change->event-form#preview" } 
              %>
            </label>

            <!-- Image previews -->
            <div data-event-form-target="preview" class="mt-2 flex flex-wrap gap-2"></div>
          </div>
        </div>


        <div>
          <%= f.label :published, "Is Published", class: "block text-sm/6 font-medium text-black" %>

          <div class="flex items-center gap-3">
            <%= f.check_box :published,
                class: "h-4 w-4 rounded border-gray-300 text-indigo-600
                        focus:ring-indigo-500" %>

            <span class="text-sm text-gray-700">
              Make this event visible to users
            </span>
          </div>
        </div>
      </div>

      <!-- ================= TICKETS SECTION ================= -->
      <div class="mt-10 border-t pt-6">

        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-black">
            üéü Tickets
          </h3>

          <button
            type="button"
            data-action="click->event-form#openDrawer"
            class="rounded-md border px-3 py-1.5 text-sm font-medium hover:bg-gray-50"
          >
            Manage Tickets
          </button>
        </div>

        <!-- Empty state -->
        <div
          data-event-form-target="emptyState"
          class="mt-3 rounded-md bg-yellow-50 border border-yellow-200 p-3 text-sm text-yellow-800"
        >
          ‚ö†Ô∏è No tickets added yet. You must add at least one ticket before creating the event.
        </div>

        <!-- Ticket summary list -->
        <div data-event-form-target="ticketsContainer"></div>

      </div>

      <% if @event.errors[:base].any? %>
        <div class="mb-4 rounded-md bg-red-50 border border-red-200 p-3 text-sm text-red-700">
          <%= @event.errors[:base].join(", ") %>
        </div>
      <% end %>

      <!-- Ticket summary list -->
      <div data-event-form-target="hiddenFields"></div>

      <div class="mt-6 flex justify-center">
          <%= f.submit "Create Event",
            data: { event_form_target: "submit" },
            class: "w-1/2 rounded-md bg-indigo-500 px-3 py-1.5 text-sm font-semibold text-black
                    hover:bg-indigo-400 disabled:opacity-40 disabled:cursor-not-allowed"
          %>
      </div>
    <% end %>
  </div>

   <!-- ================= DRAWER ================= -->
  <div
    data-event-form-target="drawer"
    class="hidden fixed inset-y-0 left-0 z-50 w-[420px] bg-white shadow-xl border-r"
  >

    <div class="flex items-center justify-between p-4 border-b">
      <h3 class="font-semibold text-lg">Manage Tickets</h3>

      <button
        type="button"
        data-action="click->event-form#closeDrawer"
        class="text-gray-500 hover:text-black"
      >
        ‚úï
      </button>
    </div>

    <div class="p-4 space-y-4">

      <div>
        <label class="block text-sm font-medium">Ticket type</label>
        <select 
          data-event-form-target="ticketTypeInput" 
          data-action="change->event-form#toggleSalesDates"
          class="mt-1 w-full rounded-md border px-3 py-1.5"

        >
          <option value="early_bird">Early Bird</option>
          <option value="regular" selected>Regular</option>
          <option value="vip">VIP</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium">Description</label>
        <textarea data-event-form-target="descriptionInput" class="mt-1 w-full rounded-md border px-3 py-1.5"></textarea>
      </div>

      <div>
        <label class="block text-sm font-medium">Price (‚Ç¨)</label>
        <input
          type="number"
          step="0.01"
          data-event-form-target="priceInput"
          class="mt-1 w-full rounded-md border px-3 py-1.5"
        >
      </div>

      <div>
        <label class="block text-sm font-medium">Quantity</label>
        <input
          type="number"
          data-event-form-target="quantityInput"
          class="mt-1 w-full rounded-md border px-3 py-1.5"
        >
      </div>

      <div data-event-form-target="salesStartWrapper" style="display:none;">
        <label class="block text-sm font-medium">Sales Start Date</label>
        <input
          type="date"
          data-event-form-target="salesStartInput"
          class="mt-1 w-full rounded-md border px-3 py-1.5"
        >
      </div>

      <div data-event-form-target="salesEndWrapper" style="display:none;">
        <label class="block text-sm font-medium">Sales End Date</label>
        <input
          type="date"
          data-event-form-target="salesEndInput"
          class="mt-1 w-full rounded-md border px-3 py-1.5"
        >
      </div>

      <button
        type="button"
        data-action="click->event-form#addTicket"
        class="w-full rounded-md bg-indigo-500 px-3 py-1.5 text-sm font-semibold text-black hover:bg-indigo-400"
      >
        Add Ticket
      </button>

    </div>
  </div>
</div>