<!-- Search & Filters -->
<%= form_with url: root_path, method: :get, local: true, 
  data: { controller: "search", action: "change->search#submit", search_target: "form" } do 
%>
  <div class="border-b border-gray-200 bg-white px-6 py-4">
    <div class="flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between">

      <!-- Left: Search -->
      <div class="relative w-full lg:max-w-sm">
        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
          <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M21 21l-4.35-4.35m1.6-5.15a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </div>
        <%= search_field_tag :query, params[:query], 
          placeholder: "Search events...",
          class: "block w-full rounded-md border border-gray-300 py-2 pl-10 pr-3 text-sm
                focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500" 
        %>
      </div>

      <!-- Right: Filters -->
      <div class="grid w-full grid-cols-2 gap-3 sm:grid-cols-4 lg:flex lg:w-auto lg:items-end lg:gap-3">

        <!-- Start Date -->
        <div class="flex flex-col">
          <label class="text-xs font-medium text-gray-600">Start date</label>
          <%= date_field_tag :start_date, params[:start_date], 
            class: "rounded-md border border-gray-300 px-3 py-2 text-sm
                  focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"
          %>
        </div>

        <!-- End Date -->
        <div class="flex flex-col">
          <label class="text-xs font-medium text-gray-600">End date</label>
          <%= date_field_tag :end_date, params[:end_date], 
            class: "rounded-md border border-gray-300 px-3 py-2 text-sm
                  focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"
          %>
        </div>

        <!-- Location -->
        <div class="flex flex-col">
          <label class="text-xs font-medium text-gray-600">Location</label>
          <%= text_field_tag :location, params[:location], placeholder: "e.g. Berlin", 
            class: "rounded-md border border-gray-300 px-3 py-2 text-sm
                  focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500" 
          %>
        </div>

        <!-- Status -->
        <div class="flex flex-col">
          <label class="text-xs font-medium text-gray-600">Status</label>
          <%= select_tag :status, 
            options_for_select([["All", ""], ["Draft", "draft"], ["Published", "published"], ["Cancelled", "cancelled"], ["Out of Stock", "out_of_stock"], ["Archived", "archived"]], 
            params[:status]), 
            class: "rounded-md border border-gray-300 px-3 py-2 text-sm
                  focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"
          %>
        </div>

      </div>
    </div>
  </div>
<% end %>


<div class="overflow-x-auto">
  <table class="min-w-full divide-y divide-gray-200">
    
    <!-- Table Head (hidden on mobile) -->
    <thead class="hidden bg-gray-50 sm:table-header-group">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-600">
          Event Name
        </th>
        <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-600">
          Start Date
        </th>
        <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-600">
          End Date
        </th>
        <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-600">
          Location
        </th>
        <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-600">
          Status
        </th>
        <th class="px-6 py-3 text-right text-xs font-semibold uppercase tracking-wider text-gray-600">
          Actions
        </th>
      </tr>
    </thead>

    <tbody class="divide-y divide-gray-100 bg-white">
      <% @events.each do |event| %>
        <%= render "tableRow", event: event %>
      <% end %>
    </tbody>
  </table>
</div>

<!-- Pagination -->
<% if @total_events > 0 %>
  <div class="flex flex-col gap-4 border-t border-gray-200 px-6 py-4 sm:flex-row sm:items-center sm:justify-between">
    
    <!-- Results info -->
    <p class="text-sm text-gray-600">
      Showing <span class="font-medium"><%= (@current_page - 1) * 10 + 1 %></span> to <span class="font-medium"><%= [@current_page * 10, @total_events].min %></span> of
      <span class="font-medium"><%= @total_events %></span> events
    </p>

    <!-- Pagination controls -->
    <div class="flex items-center justify-between gap-2 sm:justify-end">
      
      <!-- Mobile: Prev / Next -->
      <div class="flex w-full gap-2 sm:hidden">
        <% if @current_page > 1 %>
          <%= link_to "Previous", root_path(params.to_unsafe_h.merge(page: @current_page - 1)), 
            class: "w-full rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100" %>
        <% else %>
          <button disabled
            class="w-full rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-400 cursor-not-allowed"
          >
            Previous
          </button>
        <% end %>
        
        <% if @current_page < @total_pages %>
          <%= link_to "Next", root_path(params.to_unsafe_h.merge(page: @current_page + 1)), 
            class: "w-full rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500" %>
        <% else %>
          <button disabled
            class="w-full rounded-md bg-gray-400 px-4 py-2 text-sm font-semibold text-white cursor-not-allowed"
          >
            Next
          </button>
        <% end %>
      </div>

      <!-- Desktop: Page numbers -->
      <div class="hidden items-center gap-1 sm:flex">
        <% if @current_page > 1 %>
          <%= link_to "Previous", root_path(params.to_unsafe_h.merge(page: @current_page - 1)), 
            class: "rounded-md border border-gray-300 px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-100" %>
        <% else %>
          <button disabled
            class="rounded-md border border-gray-300 px-3 py-1.5 text-sm text-gray-400 cursor-not-allowed"
          >
            Previous
          </button>
        <% end %>

        <% (1..@total_pages).each do |page| %>
          <% if page == @current_page %>
            <button class="rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold text-white">
              <%= page %>
            </button>
          <% else %>
            <%= link_to page, root_path(params.to_unsafe_h.merge(page: page)), 
              class: "rounded-md border border-gray-300 px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-100" %>
          <% end %>
        <% end %>

        <% if @current_page < @total_pages %>
          <%= link_to "Next", root_path(params.to_unsafe_h.merge(page: @current_page + 1)), 
            class: "rounded-md border border-gray-300 px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-100" %>
        <% else %>
          <button disabled
            class="rounded-md border border-gray-300 px-3 py-1.5 text-sm text-gray-400 cursor-not-allowed"
          >
            Next
          </button>
        <% end %>
      </div>

    </div>
  </div>
<% end %>

